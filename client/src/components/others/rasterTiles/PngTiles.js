import { LayersControl, TileLayer } from "react-leaflet";
import React, { useState, useContext, useEffect } from "react";
import VarsState from "../../contexts/VarsState";

const PngTilesLayers = ({ pngTileLayersData }) => {
  const { varsState, setVarState } = useContext(VarsState);

  const dates = [
    20210201090000, 20210201093000, 20210201100000, 20210201103000,
    20210201110000, 20210201113000, 20210201120000, 20210201123000,
    20210201130000, 20210201133000, 20210201140000, 20210201143000,
    20210201150000, 20210201153000, 20210201160000, 20210201163000,
    20210201170000, 20210201173000, 20210201180000, 20210201183000,
    20210201190000, 20210201193000, 20210201200000, 20210201203000,
    20210201210000, 20210201213000, 20210201220000, 20210201223000,
    20210201090000, 20210201093000, 20210201100000, 20210201103000,
    20210201110000, 20210201113000, 20210201120000, 20210201123000,
    20210201130000, 20210201133000, 20210201140000, 20210201143000,
    20210201150000, 20210201153000, 20210201160000, 20210201163000,
    20210201170000, 20210201173000, 20210201180000, 20210201183000,
    20210201190000, 20210201193000, 20210201200000, 20210201203000,
    20210201210000, 20210201213000, 20210201220000, 20210201223000,
    20210201090000, 20210201093000, 20210201100000, 20210201103000,
    20210201110000, 20210201113000, 20210201120000, 20210201123000,
    20210201130000, 20210201133000, 20210201140000, 20210201143000,
    20210201150000, 20210201153000, 20210201160000, 20210201163000,
    20210201170000, 20210201173000, 20210201180000, 20210201183000,
    20210201190000, 20210201193000, 20210201200000, 20210201203000,
    20210201210000, 20210201213000, 20210201220000, 20210201223000,
    20210201090000, 20210201093000, 20210201100000, 20210201103000,
    20210201110000, 20210201113000, 20210201120000, 20210201123000,
    20210201130000, 20210201133000, 20210201140000, 20210201143000,
    20210201150000, 20210201153000, 20210201160000, 20210201163000,
    20210201170000, 20210201173000, 20210201180000, 20210201183000,
    20210201190000, 20210201193000, 20210201200000, 20210201203000,
    20210201210000, 20210201213000, 20210201220000, 20210201223000,
    20210201090000, 20210201093000, 20210201100000, 20210201103000,
    20210201110000, 20210201113000, 20210201120000, 20210201123000,
    20210201130000, 20210201133000, 20210201140000, 20210201143000,
    20210201150000, 20210201153000, 20210201160000, 20210201163000,
    20210201170000, 20210201173000, 20210201180000, 20210201183000,
    20210201190000, 20210201193000, 20210201200000, 20210201203000,
    20210201210000, 20210201213000, 20210201220000, 20210201223000,
    20210201090000, 20210201093000, 20210201100000, 20210201103000,
    20210201110000, 20210201113000, 20210201120000, 20210201123000,
    20210201130000, 20210201133000, 20210201140000, 20210201143000,
    20210201150000, 20210201153000, 20210201160000, 20210201163000,
    20210201170000, 20210201173000, 20210201180000, 20210201183000,
    20210201190000, 20210201193000, 20210201200000, 20210201203000,
    20210201210000, 20210201213000, 20210201220000, 20210201223000,
    20210201090000, 20210201093000, 20210201100000, 20210201103000,
    20210201110000, 20210201113000, 20210201120000, 20210201123000,
    20210201130000, 20210201133000, 20210201140000, 20210201143000,
    20210201150000, 20210201153000, 20210201160000, 20210201163000,
    20210201170000, 20210201173000, 20210201180000, 20210201183000,
    20210201190000, 20210201193000, 20210201200000, 20210201203000,
    20210201210000, 20210201213000, 20210201220000, 20210201223000,
    20210201090000, 20210201093000, 20210201100000, 20210201103000,
    20210201110000, 20210201113000, 20210201120000, 20210201123000,
    20210201130000, 20210201133000, 20210201140000, 20210201143000,
    20210201150000, 20210201153000, 20210201160000, 20210201163000,
    20210201170000, 20210201173000, 20210201180000, 20210201183000,
    20210201190000, 20210201193000, 20210201200000, 20210201203000,
    20210201210000, 20210201213000, 20210201220000, 20210201223000,
    20210201090000, 20210201093000, 20210201100000, 20210201103000,
    20210201110000, 20210201113000, 20210201120000, 20210201123000,
    20210201130000, 20210201133000, 20210201140000, 20210201143000,
    20210201150000, 20210201153000, 20210201160000, 20210201163000,
    20210201170000, 20210201173000, 20210201180000, 20210201183000,
    20210201190000, 20210201193000, 20210201200000, 20210201203000,
    20210201210000, 20210201213000, 20210201220000, 20210201223000,
    20210201090000, 20210201093000, 20210201100000, 20210201103000,
    20210201110000, 20210201113000, 20210201120000, 20210201123000,
    20210201130000, 20210201133000, 20210201140000, 20210201143000,
    20210201150000, 20210201153000, 20210201160000, 20210201163000,
    20210201170000, 20210201173000, 20210201180000, 20210201183000,
    20210201190000, 20210201193000, 20210201200000, 20210201203000,
    20210201210000, 20210201213000, 20210201220000, 20210201223000,
  ];

  const [time, setTime] = useState(0);
  const [animationActive, setAnimationActive] = useState(false);

  useEffect(() => {
    setAnimationActive(true);

    const interval = setInterval(() => {
      setTime((time) => time + 1);
    }, 5000);

    if (time >= 30) {
      setAnimationActive(false);
      clearInterval(interval);
    }
    return () => {
      setAnimationActive(false);
      clearInterval(interval);
    };
  }, [time, animationActive]);

  return (
    <>
      {Object.keys(pngTileLayersData).map((tileLayer) => {
        return (
          <LayersControl.Overlay
            checked={pngTileLayersData[tileLayer].checked}
            name={pngTileLayersData[tileLayer].name}
          >
            <TileLayer
              attribution={pngTileLayersData[tileLayer].attribution}
              url={pngTileLayersData[tileLayer].url.replace(
                "date",
                dates[time]
              )}
              tms={pngTileLayersData[tileLayer].tms}
              opacity={pngTileLayersData[tileLayer].opacity}
            />
          </LayersControl.Overlay>
        );
      })}
    </>
  );
};

export default PngTilesLayers;
